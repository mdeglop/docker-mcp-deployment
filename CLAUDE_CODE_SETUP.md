# Claude Code MCP Gateway Configuration

This document explains how to connect Claude Code CLI to the remote MCP Gateway.

## Configuration File

Add this configuration to your Claude Code settings.

### Global Configuration (All Projects)

Add to `~/.claude.json` in the `mcpServers` section:

```json
{
  "mcpServers": {
    "remote-mcp-gateway": {
      "type": "sse",
      "url": "https://mcp.srv1077490.hstgr.cloud/sse",
      "headers": {
        "Authorization": "Bearer q4yuztnx1gjqjrq1iq6vissc00z3h4jaow0x4jl4xgls4zlyb5"
      }
    }
  }
}
```

### Using CLI Command

Alternatively, use the Claude CLI to add the server:

```bash
claude mcp add --transport sse remote-mcp-gateway \
  https://mcp.srv1077490.hstgr.cloud/sse \
  --header "Authorization: Bearer q4yuztnx1gjqjrq1iq6vissc00z3h4jaow0x4jl4xgls4zlyb5"
```

## Configuration Details

- **Transport Type**: SSE (Server-Sent Events)
- **Gateway URL**: `https://mcp.srv1077490.hstgr.cloud/sse`
- **Authentication**: Bearer token in Authorization header
- **Bearer Token**: `q4yuztnx1gjqjrq1iq6vissc00z3h4jaow0x4jl4xgls4zlyb5`

## Important Notes

1. **Token Rotation**: The bearer token is auto-generated by the MCP Gateway and changes on each restart. Check the gateway logs after restart to get the new token:

   ```bash
   journalctl -u mcp-gateway -f | grep "Bearer token"
   ```

2. **SSE Deprecation**: SSE transport is deprecated in favor of HTTP/Streamable HTTP. However, the Docker MCP Gateway currently uses SSE.

3. **Configuration Scope**:
   - Global config (`~/.claude.json` mcpServers): Available in all projects
   - Project config (`.claude.json` in project, under projects.<path>.mcpServers): Available only in that project

## Available MCP Servers (14 Total)

Once connected, you'll have access to all servers in the gateway catalog:

1. **context7** - Code documentation for LLMs
2. **desktop-commander** - System operations
3. **duckduckgo** - Web search
4. **github-official** - GitHub operations
5. **markdownify** - Web to markdown conversion
6. **memory** - Persistent conversation memory
7. **next-devtools-mcp** - Next.js development tools
8. **playwright** - Browser automation
9. **puppeteer** - Browser automation (alternative)
10. **sequentialthinking** - Chain-of-thought reasoning
11. **supabase** - Database operations
12. **youtube_transcript** - Video transcripts
13. **filesystem** - Local file operations
14. **n8n-mcp** - n8n workflow management

## Verification

Test the connection in Claude Code:

```bash
# In Claude Code CLI, type:
/mcp

# You should see:
# ✓ remote-mcp-gateway (connected)
#   - Lists all 14 available MCP servers
```

## Troubleshooting

### "Failed to connect" or "Failed to authenticate"

1. Check the bearer token is current:

   ```bash
   ssh root@srv1077490.hstgr.cloud "journalctl -u mcp-gateway -n 50 | grep Bearer"
   ```

2. Verify the gateway is running:

   ```bash
   ssh root@srv1077490.hstgr.cloud "systemctl status mcp-gateway"
   ```

3. Test the endpoint directly:

   ```bash
   curl -H "Authorization: Bearer <token>" \
        -H "Accept: text/event-stream" \
        https://mcp.srv1077490.hstgr.cloud/sse
   ```

### Configuration Schema Errors

The correct schema for SSE servers with authentication is:

```json
{
  "type": "sse", // Required: transport type
  "url": "string", // Required: SSE endpoint URL
  "headers": {
    // Optional: custom headers (top-level, not nested)
    "Authorization": "Bearer <token>"
  }
}
```

Common mistakes:

- ❌ Nesting headers inside a `transport` object
- ❌ Using `command` and `args` for SSE servers (those are for stdio)
- ❌ Putting token in URL query parameters instead of headers

## Server Management

### Restart Gateway

```bash
ssh root@srv1077490.hstgr.cloud "systemctl restart mcp-gateway"
```

### View Gateway Logs

```bash
ssh root@srv1077490.hstgr.cloud "journalctl -u mcp-gateway -f"
```

### Update Bearer Token in Config

After gateway restart, get new token and update:

```bash
# Get new token
NEW_TOKEN=$(ssh root@srv1077490.hstgr.cloud "journalctl -u mcp-gateway -n 100" | grep -oP 'Bearer token: \K[a-z0-9]+' | tail -1)

# Update config
jq --arg token "$NEW_TOKEN" \
   '.mcpServers."remote-mcp-gateway".headers.Authorization = "Bearer " + $token' \
   ~/.claude.json > ~/.claude.json.tmp && mv ~/.claude.json.tmp ~/.claude.json
```

## Related Files

- Server deployment: `/root/docker-compose.yml` on srv1077490.hstgr.cloud
- Gateway config: `~/.docker/mcp/catalogs/custom-catalog.yaml` on server
- Gateway service: `/etc/systemd/system/mcp-gateway.service` on server
- Full deployment docs: `./deployment/DEPLOYMENT_COMPLETE.md`

## Testing with MCP Inspector

You can also test the connection using the MCP Inspector:

```bash
npx @modelcontextprotocol/inspector

# Then in browser at http://localhost:6274:
# - Transport: SSE
# - URL: https://mcp.srv1077490.hstgr.cloud/sse
# - Header: Authorization = Bearer <token>
```

---

**Last Updated**: 2025-11-17
**Gateway Version**: Docker MCP Gateway (latest)
**Claude Code Version**: 2.0.42
